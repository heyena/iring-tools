<Project DefaultTargets="Build" ToolsVersion="3.5" xmlns="http://schemas.microsoft.com/developer/msbuild/2003">
  <Import Project="$(MSBuildExtensionsPath)\MSBuildCommunityTasks\MSBuild.Community.Tasks.Targets" />

  <PropertyGroup>
    <AssemblyInfoFile>$(MSBuildProjectDirectory)\AssemblyInfo.cs</AssemblyInfoFile>
    <Major>2</Major>
    <Minor>0</Minor>
    <Build>0</Build>
    <Revision>0</Revision>
  </PropertyGroup>

  <PropertyGroup>
    <SolutionFile>iring-tools.sln</SolutionFile>
    <DeploymentDir>$(MSBuildProjectDirectory)\Deployment</DeploymentDir>
    <iRINGAdapter>$(DeploymentDir)\iRINGAdapter</iRINGAdapter>
    <iRINGSandbox>$(DeploymentDir)\iRINGSandbox</iRINGSandbox>
    <LandingPageDir>LandingPage</LandingPageDir>
    <AdapterDir>Adapter</AdapterDir>
    <AdapterServiceDir>$(AdapterDir)\AdapterService</AdapterServiceDir>
    <AdapterLibraryDir>$(AdapterDir)\AdapterLibrary</AdapterLibraryDir>
    <JosekiInterfaceServiceDir>InterfaceService.Joseki</JosekiInterfaceServiceDir>
    <dotNetRdfInterfaceServiceDir>InterfaceService.dotNetRdf</dotNetRdfInterfaceServiceDir>
    <SemWebInterfaceServiceDir>InterfaceService.SemWeb</SemWebInterfaceServiceDir>
    <JosekiSandboxServiceDir>SandboxService.Joseki</JosekiSandboxServiceDir>
    <SemWebSandboxServiceDir>SandboxService.SemWeb</SemWebSandboxServiceDir>
    <MappingEditorDir>MappingEditor\MappingEditor.Web</MappingEditorDir>
    <ApplicationEditorDeploymentDir>$(iRINGAdapter)\ApplicationEditor</ApplicationEditorDeploymentDir>
    <RefDataEditorDir>RefDataEditor\RefDataEditor.Web</RefDataEditorDir>
    <ApplicationEditorDir>NHibernateEditor\NHibernateEditor.Web</ApplicationEditorDir>
    <RefDataDir>ReferenceData</RefDataDir>
    <ApplicationServiceDir>NHibernate\NHibernateService</ApplicationServiceDir>
    <ApplicationServiceDeploymentDir>$(iRINGAdapter)\ApplicationService</ApplicationServiceDeploymentDir>
    <LandingPageDeploymentDir>$(DeploymentDir)\LandingPage</LandingPageDeploymentDir>
    <RefDataServiceDir>$(RefDataDir)\ReferenceDataService</RefDataServiceDir>
    <DbDictionaryServiceDir>NHibernate\NHibernateService</DbDictionaryServiceDir>
    <AdapterServiceDeploymentDir>$(iRINGAdapter)\AdapterService</AdapterServiceDeploymentDir>
    <DbDictionaryServiceDeploymentDir>$(iRINGAdapter)\DbDictionaryService</DbDictionaryServiceDeploymentDir>
    <JosekiInterfaceServiceDeploymentDir>$(iRINGAdapter)\InterfaceService.Joseki</JosekiInterfaceServiceDeploymentDir>
    <dotNetRdfInterfaceServiceDeploymentDir>$(iRINGAdapter)\InterfaceService.dotNetRdf</dotNetRdfInterfaceServiceDeploymentDir>
    <SemWebInterfaceServiceDeploymentDir>$(iRINGAdapter)\InterfaceService.SemWeb</SemWebInterfaceServiceDeploymentDir>
    <AdapterToolsDeploymentDir>$(iRINGAdapter)\Tools</AdapterToolsDeploymentDir>
    <MappingEditorDeploymentDir>$(iRINGAdapter)\MappingEditor</MappingEditorDeploymentDir>
    <DbDictionaryEditorDeploymentDir>$(iRINGAdapter)\DbDictionaryEditor</DbDictionaryEditorDeploymentDir>
    <RefDataEditorDeploymentDir>$(iRINGSandbox)\RefDataEditor</RefDataEditorDeploymentDir>
    <RefDataServiceDeploymentDir>$(iRINGSandbox)\RefDataService</RefDataServiceDeploymentDir>
    <JosekiSandboxServiceDeploymentDir>$(iRINGSandbox)\SandboxService.Joseki</JosekiSandboxServiceDeploymentDir>
    <SemWebSandboxServiceDeploymentDir>$(iRINGSandbox)\SandboxService.SemWeb</SemWebSandboxServiceDeploymentDir>
    <SandboxToolsDeploymentDir>$(iRINGSandbox)\Tools</SandboxToolsDeploymentDir>    
    <CSVDataLayerDir>CSVDataLayer</CSVDataLayerDir>
    <CSVDataLayerSolutionFile>$(CSVDataLayerDir)\CSVDataLayer.sln</CSVDataLayerSolutionFile>
    <SDKDeploymentDir>$(DeploymentDir)\SDK</SDKDeploymentDir>
    <CSVDataLayerDeploymentDir>$(SDKDeploymentDir)\CSVDataLayer</CSVDataLayerDeploymentDir>  
    <CSVDataLayerLibDeploymentDir>$(CSVDataLayerDeploymentDir)\lib</CSVDataLayerLibDeploymentDir>    
    <MSTestCmd>"$(VSINSTALLDIR)\Common7\IDE\MSTest.exe"</MSTestCmd>
    <ZipCmd>"$(MSBuildProjectDirectory)\ExternalBinaries\7-Zip\7z.exe"</ZipCmd>
  </PropertyGroup>

  <ItemGroup>
    <UnitTest Include="RefDataServiceTests">
      <TestContainer>/testcontainer:$(RefDataDir)\ReferenceDataService.Tests\bin\Debug\ReferenceDataService.Tests.dll</TestContainer>
    </UnitTest>
    <UnitTest Include="AdapterServiceTests">
      <TestContainer>/testcontainer:$(AdapterDir)\AdapterService.Tests\bin\Debug\AdapterService.Tests.dll /runconfig:AdapterService.testrunconfig</TestContainer>
    </UnitTest>
  </ItemGroup>

  <ItemGroup>
    <AdapterServiceDeployment
      Include="$(AdapterServiceDir)\**"
      Exclude="$(AdapterServiceDir).Tests\**;
               $(AdapterServiceDir)\bin\*.pdb;
               $(AdapterServiceDir)\bin\*.xml;
               $(AdapterServiceDir)\Logs\**;
               $(AdapterServiceDir)\Templates\**;
               $(AdapterServiceDir)\Transforms\**;
               $(AdapterServiceDir)\obj\**;
               $(AdapterServiceDir)\Properties\**;
               $(AdapterServiceDir)\*.csproj;
               $(AdapterServiceDir)\*.user;
               $(AdapterServiceDir)\*.vspscc;
               $(AdapterServiceDir)\web.config;
               $(AdapterServiceDir)\Web_Development.config;
               $(AdapterServiceDir)\Service.cs;
               $(AdapterServiceDir)\IService.cs;
               $(AdapterServiceDir)\Global.asax.cs;
               $(AdapterServiceDir)\App_Code\Model.*.cs;               
               $(AdapterServiceDir)\XML\BindingConfiguration.*.xml;
               $(AdapterServiceDir)\XML\DataDictionary.*.xml;
               $(AdapterServiceDir)\XML\DTO.*.xml;
               $(AdapterServiceDir)\XML\QXF.*.xml;
               $(AdapterServiceDir)\XML\RDF.*.xml;
               $(AdapterServiceDir)\XML\nh-configuration.*.xml;
               $(AdapterServiceDir)\XML\nh-mapping.*.xml;
               $(AdapterServiceDir)\XML\Scopes.xml;
               $(AdapterServiceDir)\.svn\**;
               $(AdapterServiceDir)\*\.svn\**;
               $(AdapterServiceDir)\*\*\.svn\**;">
    </AdapterServiceDeployment>

    <JosekiInterfaceServiceDeployment
      Include="$(JosekiInterfaceServiceDir)\**"
      Exclude="$(JosekiInterfaceServiceDir)\.svn\**;
               $(JosekiInterfaceServiceDir)\*\.svn\**;
               $(JosekiInterfaceServiceDir)\*\*\.svn\**;
               $(JosekiInterfaceServiceDir)\*\*\*\.svn\**;
               $(JosekiInterfaceServiceDir)\*.log;">
    </JosekiInterfaceServiceDeployment>

    <dotNetRdfInterfaceServiceDeployment
      Include="$(dotNetRdfInterfaceServiceDir)\**"
      Exclude="$(dotNetRdfInterfaceServiceDir)\App_Code;
               $(dotNetRdfInterfaceServiceDir)\App_Data;
               $(dotNetRdfInterfaceServiceDir)\bin\*.pdb;
               $(dotNetRdfInterfaceServiceDir)\bin\*.xml;
               $(dotNetRdfInterfaceServiceDir)\obj\**;
               $(dotNetRdfInterfaceServiceDir)\Properties\**;
               $(dotNetRdfInterfaceServiceDir)\*.cs;
               $(dotNetRdfInterfaceServiceDir)\*.csproj;
               $(dotNetRdfInterfaceServiceDir)\*.user;
               $(dotNetRdfInterfaceServiceDir)\*.vspscc;
               $(dotNetRdfInterfaceServiceDir)\Web.config;
               $(dotNetRdfInterfaceServiceDir)\Web_Development.config;
               $(dotNetRdfInterfaceServiceDir)\.svn\**;
               $(dotNetRdfInterfaceServiceDir)\*\.svn\**;
               $(dotNetRdfInterfaceServiceDir)\*\*\.svn\**;
               $(dotNetRdfInterfaceServiceDir)\*\*\*\.svn\**;
               $(dotNetRdfInterfaceServiceDir)\*.log;">
    </dotNetRdfInterfaceServiceDeployment>

    <SemWebInterfaceServiceDeployment
      Include="$(SemWebInterfaceServiceDir)\**"
      Exclude="$(SemWebInterfaceServiceDir)\web.config;
               $(SemWebInterfaceServiceDir)\setup.conf;
               $(SemWebInterfaceServiceDir)\.svn\**;
               $(SemWebInterfaceServiceDir)\*\.svn\**;">
    </SemWebInterfaceServiceDeployment>

    <JosekiSandboxServiceDeployment
      Include="$(JosekiSandboxServiceDir)\**"
      Exclude="$(JosekiSandboxServiceDir)\.svn\**;
               $(JosekiSandboxServiceDir)\*\.svn\**;
               $(JosekiSandboxServiceDir)\*\*\.svn\**;
               $(JosekiSandboxServiceDir)\*\*\*\.svn\**;
               $(JosekiSandboxServiceDir)\*.log;">
    </JosekiSandboxServiceDeployment>

    <SemWebSandboxServiceDeployment
      Include="$(SemWebSandboxServiceDir)\**"
      Exclude="$(SemWebSandboxServiceDir)\web.config;
               $(SemWebSandboxServiceDir)\setup.conf;
               $(SemWebSandboxServiceDir)\.svn\**;
               $(SemWebSandboxServiceDir)\*\.svn\**;">
    </SemWebSandboxServiceDeployment>

    <MappingEditorDeployment
      Include="$(MappingEditorDir)\**"
      Exclude="$(MappingEditorDir)\bin\*.pdb;
               $(MappingEditorDir)\bin\*.xml;
               $(MappingEditorDir)\obj\**;
               $(MappingEditorDir)\Properties\**;
               $(MappingEditorDir)\*.html;
               $(MappingEditorDir)\*.csproj;
               $(MappingEditorDir)\*.cs;
               $(MappingEditorDir)\*.user;
               $(MappingEditorDir)\*.vspscc;
               $(MappingEditorDir)\web.config;
               $(MappingEditorDir)\.svn\**;
               $(MappingEditorDir)\*\.svn\**">
    </MappingEditorDeployment>

    <LandingPageDeployment
      Include="$(LandingPageDir)\**"
      Exclude="$(LandingPageDir)\.svn\**;
               $(LandingPageDir)\*\.svn\**;">
    </LandingPageDeployment>

    <RefDataEditorDeployment
      Include="$(RefDataEditorDir)\**"
      Exclude="$(RefDataEditorDir)\bin\*.pdb;
               $(RefDataEditorDir)\bin\*.xml;
               $(RefDataEditorDir)\obj\**;
               $(RefDataEditorDir)\Properties\**;
               $(RefDataEditorDir)\*.cs;
               $(RefDataEditorDir)\*.html;
               $(RefDataEditorDir)\*.csproj;
               $(RefDataEditorDir)\*.user;
               $(RefDataEditorDir)\*.vspscc;
               $(RefDataEditorDir)\web.config;
               $(RefDataEditorDir)\.svn\**;
               $(RefDataEditorDir)\*\.svn\**">
    </RefDataEditorDeployment>

    <ApplicationEditorDeployment
     Include="$(ApplicationEditorDir)\**"
     Exclude="$(ApplicationEditorDir)\bin\*.pdb;
              $(ApplicationEditorDir)\bin\*.xml;
               $(ApplicationEditorDir)\obj\**;
               $(ApplicationEditorDir)\Properties\**;
               $(ApplicationEditorDir)\*.cs;
               $(ApplicationEditorDir)\*.svc;
               $(ApplicationEditorDir)\*.html;
               $(ApplicationEditorDir)\*.csproj;
               $(ApplicationEditorDir)\*.user;
               $(ApplicationEditorDir)\*.vspscc;
               $(ApplicationEditorDir)\web.config;
               $(ApplicationEditorDir)\.svn\**;
               $(ApplicationEditorDir)\*\.svn\**">
    </ApplicationEditorDeployment>

    <RefDataServiceDeployment
      Include="$(RefDataServiceDir)\**"
      Exclude="$(RefDataServiceDir).Tests\**;               
               $(RefDataServiceDir)\bin\*.pdb;
               $(RefDataServiceDir)\bin\*.xml;
               $(RefDataServiceDir)\Logs\**;
               $(RefDataServiceDir)\obj\**;
               $(RefDataServiceDir)\Properties\**;
               $(RefDataServiceDir)\Service.cs;
               $(RefDataServiceDir)\IService.cs;
               $(RefDataServiceDir)\Global.asax.cs;
               $(RefDataServiceDir)\XML\Repositories.xml;
               $(RefDataServiceDir)\XML\Repositories_Development.xml;
               $(RefDataServiceDir)\*.csproj;
               $(RefDataServiceDir)\*.user;
               $(RefDataServiceDir)\*.vspscc;
               $(RefDataServiceDir)\web.config;
               $(RefDataServiceDir)\Web_Development.config;
               $(RefDataServiceDir)\.svn\**;
               $(RefDataServiceDir)\*\.svn\**;">
    </RefDataServiceDeployment>

    <ApplicationServiceDeployment
      Include="$(ApplicationServiceDir)\**"
      Exclude="$(ApplicationServiceDir)\bin\*.pdb;
               $(ApplicationServiceDir)\bin\*.xml;
               $(ApplicationServiceDir)\Logs\**;
               $(ApplicationServiceDir)\obj\**;
               $(ApplicationServiceDir)\Properties\**;
               $(ApplicationServiceDir)\Service.cs;
               $(ApplicationServiceDir)\IService.cs;
               $(ApplicationServiceDir)\Global.asax.cs;
               $(ApplicationServiceDir)\*.csproj;
               $(ApplicationServiceDir)\*.user;
               $(ApplicationServiceDir)\*.vspscc;
               $(ApplicationServiceDir)\web.config;
               $(ApplicationServiceDir)\Web_Development.config;
               $(ApplicationServiceDir)\.svn\**;
               $(ApplicationServiceDir)\*\.svn\**;
               $(ApplicationServiceDir)\*\*\.svn\**;">
    </ApplicationServiceDeployment>

    <AdapterToolsDeployment
      Include="ExternalBinaries\SemWeb\rdfstorage.exe;
               ExternalBinaries\SemWeb\SemWeb.dll;
               ExternalBinaries\SemWeb\SemWeb.SQLServerStore.dll;
               ExternalBinaries\SemWeb\Mono.GetOptions.dll;
               Libraries\iRINGLibrary\Desktop\bin\Debug\iRINGLibrary.dll;
               Libraries\iRINGLibrary\Desktop\bin\Debug\UtilityLibrary.dll;
               Utilities\EncryptCredentials\bin\Debug\EncryptCredentials.exe;
               Utilities\AdapterClient\bin\Debug\AdapterClient.exe;
               Utilities\DBDictionaryUtil\DBDictionaryUtil\bin\Debug\NHibernate.dll;
               Utilities\DBDictionaryUtil\DBDictionaryUtil\bin\Debug\NHibernate.ByteCode.Castle.dll;
               Utilities\DBDictionaryUtil\DBDictionaryUtil\bin\Debug\Iesi.Collections.dll;
               Utilities\DBDictionaryUtil\DBDictionaryUtil\bin\Debug\log4net.dll;
               Utilities\DBDictionaryUtil\DBDictionaryUtil\bin\Debug\DBDictionaryUtil.exe;
               Utilities\DBDictionaryUtil\DBDictionaryUtil\App_Default.config;
               Utilities\SWDump\bin\Debug\IKVM.GNU.Classpath.dll;
               Utilities\SWDump\bin\Debug\IKVM.Runtime.dll;
               Utilities\SWDump\bin\Debug\SemWeb.dll;
               Utilities\SWDump\bin\Debug\SemWeb.Sparql.dll;
               Utilities\SWDump\bin\Debug\SemWeb.SQLServerStore.dll;
               Utilities\SWDump\bin\Debug\sparql-core.dll;
               Utilities\SWDump\bin\Debug\swdump.exe;
               Utilities\SWDump\App.Default.config;
               Utilities\RdfImportExport\RdfImportExport\bin\Debug\dotNetRDF.dll;
               Utilities\RdfImportExport\RdfImportExport\bin\Debug\dotNetRDF.xml;
               Utilities\RdfImportExport\RdfImportExport\bin\Debug\HtmlAgilityPack.dll;
               Utilities\RdfImportExport\RdfImportExport\bin\Debug\HtmlAgilityPack.xml;
               Utilities\RdfImportExport\RdfImportExport\bin\Debug\MySql.Data.dll;
               Utilities\RdfImportExport\RdfImportExport\bin\Debug\Newtonsoft.Json.dll;
               Utilities\RdfImportExport\RdfImportExport\bin\Debug\Newtonsoft.Json.xml;
               Utilities\RdfImportExport\RdfImportExport\bin\Debug\virtado3.dll;
               Utilities\RdfImportExport\RdfImportExport\bin\Debug\RdfImportExport.exe;
               Utilities\RdfImportExport\RdfImportExport\Developer_App.config;">
    </AdapterToolsDeployment>
 
    <SandboxToolsDeployment
      Include="ExternalBinaries\SemWeb\rdfstorage.exe;
               ExternalBinaries\SemWeb\SemWeb.dll;
               ExternalBinaries\SemWeb\SemWeb.SQLServerStore.dll;
               ExternalBinaries\SemWeb\Mono.GetOptions.dll;
               Libraries\iRINGLibrary\Desktop\bin\Debug\iRINGLibrary.dll;
               Libraries\iRINGLibrary\Desktop\bin\Debug\UtilityLibrary.dll;
               Utilities\EncryptCredentials\bin\Debug\EncryptCredentials.exe;
               Utilities\QMXFGenerator\QMXFGenerator\bin\Debug\QMXFGenerator.exe;
               Utilities\QMXFGenerator\QMXFGenerator\App_Default.config;
               Utilities\QMXFGenerator\QMXFGenerator\InformationModel.xls;
               Utilities\QMXFGenerator\QMXFGenerator\QMXF.xml;
               Utilities\QMXFGenerator\QMXFGenerator\bin\Debug\Microsoft.Office.Interop.Excel.dll;
               Utilities\QMXFGenerator\QMXFGenerator\bin\Debug\Microsoft.Vbe.Interop.dll;
               Utilities\QMXFGenerator\QMXFGenerator\bin\Debug\office.dll;
               Utilities\QMXFTransforms\*.dtd;
               Utilities\QMXFTransforms\*.xsd;
               Utilities\QMXFTransforms\*.xsl;">
    </SandboxToolsDeployment>

    <CSVDataLayerDeployment
      Include="$(CSVDataLayerDir)\**;"
      Exclude="$(CSVDataLayerDir)\.svn\**;
               $(CSVDataLayerDir)\*\.svn\**;
               $(CSVDataLayerDir)\*\*\.svn\**;
               $(CSVDataLayerDir)\*\*\*\.svn\**;">                    
    </CSVDataLayerDeployment>
    
    <CSVDataLayerLibDeployment
      Include="ExternalBinaries\Flee-0.9.26.0\Ciloci.Flee.chm;
               ExternalBinaries\Flee-0.9.26.0\Ciloci.Flee.dll;
               ExternalBinaries\Flee-0.9.26.0\Ciloci.Flee.xml;
               Libraries\iRINGLibrary\Desktop\bin\Debug\iRINGLibrary.dll;
               Libraries\iRINGLibrary\Desktop\bin\Debug\UtilityLibrary.dll;                
               ExternalBinaries\Ninject2\Ninject.dll;
               ExternalBinaries\NHibernate 2.0\bin\net-2.0\log4net.dll;
               ExternalBinaries\NHibernate 2.0\bin\net-2.0\log4net.license.txt;
               ExternalBinaries\NHibernate 2.0\bin\net-2.0\log4net.xml;">
    </CSVDataLayerLibDeployment>
  </ItemGroup>

  <ItemGroup>
    <DeploymentPackage Include="*" Exclude="">
      <Options>a -tzip -r</Options>
      <FileSet>$(iRINGAdapter) $(iRINGSandbox) $(LandingPageDeploymentDir)</FileSet>
      <ZipFile>$(DeploymentDir)\iRINGTools-$(Major).$(Minor).$(Build).zip</ZipFile>
    </DeploymentPackage>
    <DeploymentPackage Include="*" Exclude="">
      <Options>a -tzip -r</Options>
      <FileSet>$(SDKDeploymentDir)\*</FileSet>
      <ZipFile>$(DeploymentDir)\iRINGTools-SDK-$(Major).$(Minor).$(Build).zip</ZipFile>
    </DeploymentPackage>
  </ItemGroup>

  <Target Name="Version">
    <Message Text="Updating assembly info ..." />

    <SvnVersion LocalPath="$(MSBuildProjectDirectory)">
      <Output TaskParameter="Revision" PropertyName="Revision" />
    </SvnVersion>

    <FileUpdate
      Files="$(AssemblyInfoFile)"
      Regex="(\d+)\.(\d+)\.(\d+)(\.(\d+))*"
      ReplacementText="$(Major).$(Minor).$(Build).$(Revision)"/>
  </Target>

  <Target Name="SvnCleanUp">
    <Message Text="Performing SVN clean-up ..." />
    <Exec Command="svn cleanup"/>
  </Target>

  <Target Name="SvnUpdate">
    <Message Text="Performing SVN update ..." />
    <Exec Command="svn update"/>
  </Target>
  
  <Target Name="CleanBuild">
    <Message Text="Performing MSBuild clean-up ..." />
    <MSBuild Projects="$(SolutionFile)" Targets="Clean"/>
  </Target>
   
  <Target Name="PrepareBuild">
    <Message Text="Preparing build ..." />
    <Exec Condition="!Exists('$(AdapterServiceDir)\Web.config')" 
          Command="Copy $(AdapterServiceDir)\Web_Default.config $(AdapterServiceDir)\Web.config" />
    
    <Exec Condition="!Exists('$(dotNetRdfInterfaceServiceDir)\Web.config')"
          Command="Copy $(dotNetRdfInterfaceServiceDir)\Web_Default.config $(dotNetRdfInterfaceServiceDir)\Web.config" />
    
    <Exec Condition="!Exists('$(ApplicationServiceDir)\Web.config')" 
          Command="Copy $(ApplicationServiceDir)\Web_Default.config $(ApplicationServiceDir)\Web.config" />
    
    <Exec Condition="!Exists('$(RefDataServiceDir)\Web.config')"
          Command="Copy $(RefDataServiceDir)\Web_Default.config $(RefDataServiceDir)\Web.config" />
    
    <Exec Condition="!Exists('$(MappingEditorDir)\Web.config')"
          Command="Copy $(MappingEditorDir)\Web_Default.config $(MappingEditorDir)\Web.config" />
    
    <Exec Condition="!Exists('$(ApplicationEditorDir)\Web.config')"
          Command="Copy $(ApplicationEditorDir)\Web_Default.config $(ApplicationEditorDir)\Web.config" />
    
    <Exec Condition="!Exists('$(SemWebInterfaceServiceDir)\Web.config')"
          Command="Copy $(SemWebInterfaceServiceDir)\Web_Default.config $(SemWebInterfaceServiceDir)\Web.config" />
    
    <Exec Condition="!Exists('$(RefDataEditorDir)\Web.config')"
          Command="Copy $(RefDataEditorDir)\Web_Default.config $(RefDataEditorDir)\Web.config" />
    
    <Exec Condition="!Exists('$(SemWebSandboxServiceDir)\Web.config')"
          Command="Copy $(SemWebSandboxServiceDir)\Web_Default.config $(SemWebSandboxServiceDir)\Web.config" />
    
    <Exec Condition="!Exists('Utilities\DBDictionaryUtil\DBDictionaryUtil\App.config')"
          Command="Copy Utilities\DBDictionaryUtil\DBDictionaryUtil\App_Default.config Utilities\DBDictionaryUtil\DBDictionaryUtil\App.config" />
    
    <Exec Condition="!Exists('Utilities\SWDump\App.config')"
          Command="Copy Utilities\SWDump\App.Default.config Utilities\SWDump\App.config" />
    
    <Exec Condition="!Exists('Utilities\QMXFGenerator\QMXFGenerator\App.config')"
          Command="Copy Utilities\QMXFGenerator\QMXFGenerator\App_Default.config Utilities\QMXFGenerator\QMXFGenerator\App.config" />
    
    <Exec Condition="!Exists('Utilities\RdfImportExport\RdfImportExport\App.config')"
          Command="Copy Utilities\RdfImportExport\RdfImportExport\Developer_App.config Utilities\RdfImportExport\RdfImportExport\App.config" />
  </Target>

  <Target Name="CoreBuild" DependsOnTargets="Version">
    <Message Text="Performing MSBuild ..." />
    <MSBuild Projects="$(SolutionFile)" Targets="Build"/>
    <MSBuild Projects="$(CSVDataLayerSolutionFile)" Targets="Build"/>
  </Target>

  <Target Name="Test">
    <Message Text="Cleaning old test results ..." />
    <Exec Command="RmDir /S /Q TestResults" />
    <Message Text="Executing unit tests..." />
    <Exec Command="$(MSTestCmd) %(UnitTest.TestContainer)" />
  </Target>

  <Target Name="CreateDeployment">
    <Message Text="Cleaning up old deployment folders..." />
    <Exec Command="RmDir /S /Q $(DeploymentDir)" />
    <MakeDir Directories="$(DeploymentDir)/iRINGAdapter; $(DeploymentDir)/iRINGSandbox"/>
    <Exec Command="Copy .\ClientAccessPolicy.xml $(iRINGAdapter)\ClientAccessPolicy.xml" />
    <Exec Command="Copy .\ClientAccessPolicy.xml $(iRINGSandbox)\ClientAccessPolicy.xml" />

    <Message Text="Creating adapter service deployment ..." />
    <Copy SourceFiles="@(AdapterServiceDeployment)"
          DestinationFiles="@(AdapterServiceDeployment->'$(AdapterServiceDeploymentDir)\%(RecursiveDir)%(Filename)%(Extension)')" />
    <Exec Command="Move /Y $(AdapterServiceDeploymentDir)\Web_Default.config $(AdapterServiceDeploymentDir)\Web.config" />
    <Exec Command="Mkdir $(AdapterServiceDeploymentDir)\Logs" />
    <Exec Command="Mkdir $(AdapterServiceDeploymentDir)\App_Code"/>

    <Message Text="Creating application service deployment ..." />
    <Copy SourceFiles="@(ApplicationServiceDeployment)"
          DestinationFiles="@(ApplicationServiceDeployment->'$(ApplicationServiceDeploymentDir)\%(RecursiveDir)%(Filename)%(Extension)')" />
    <Exec Command="Move /Y $(ApplicationServiceDeploymentDir)\Web_Default.config $(ApplicationServiceDeploymentDir)\Web.config" />
    <Exec Command="Mkdir $(ApplicationServiceDeploymentDir)\Logs"/> 
   
    <!--<Message Text="Creating Joseki interface service deployment ..." />
    <Copy SourceFiles="@(JosekiInterfaceServiceDeployment)"
          DestinationFiles="@(JosekiInterfaceServiceDeployment->'$(JosekiInterfaceServiceDeploymentDir)\%(RecursiveDir)%(Filename)%(Extension)')" />
    <Exec Command="Move /Y $(JosekiInterfaceServiceDeploymentDir)\setup.default.conf $(JosekiInterfaceServiceDeploymentDir)\setup.conf" />
    <Exec Command="Move /Y $(JosekiInterfaceServiceDeploymentDir)\webapps\joseki\WEB-INF\web.default.xml $(JosekiInterfaceServiceDeploymentDir)\webapps\joseki\WEB-INF\web.xml" />-->

    <Message Text="Creating SemWeb interface service deployment ..." />
    <Copy SourceFiles="@(SemWebInterfaceServiceDeployment)"
          DestinationFiles="@(SemWebInterfaceServiceDeployment->'$(SemWebInterfaceServiceDeploymentDir)\%(RecursiveDir)%(Filename)%(Extension)')" />
    <Exec Command="Move /Y $(SemWebInterfaceServiceDeploymentDir)\Web_Default.config $(SemWebInterfaceServiceDeploymentDir)\Web.config" />
    <Exec Command="Move /Y $(SemWebInterfaceServiceDeploymentDir)\setup_default.conf $(SemWebInterfaceServiceDeploymentDir)\setup.conf" />

    <Message Text="Creating dotNetRdf interface service deployment ..." />
    <Copy SourceFiles="@(dotNetRdfInterfaceServiceDeployment)"
          DestinationFiles="@(dotNetRdfInterfaceServiceDeployment->'$(dotNetRdfInterfaceServiceDeploymentDir)\%(RecursiveDir)%(Filename)%(Extension)')" />
    <Exec Command="Move /Y $(dotNetRdfInterfaceServiceDeploymentDir)\Developer_Web.config $(dotNetRdfInterfaceServiceDeploymentDir)\Web.config" />

    <Message Text="Creating mapping editor deployment ..." />
    <Copy SourceFiles="@(MappingEditorDeployment)"
          DestinationFiles="@(MappingEditorDeployment->'$(MappingEditorDeploymentDir)\%(RecursiveDir)%(Filename)%(Extension)')" />
    <Exec Command="Move /Y $(MappingEditorDeploymentDir)\Web_Default.config $(MappingEditorDeploymentDir)\Web.config" />

    <Message Text="Creating application editor deployment ..." />
    <Copy SourceFiles="@(ApplicationEditorDeployment)"
          DestinationFiles="@(ApplicationEditorDeployment->'$(ApplicationEditorDeploymentDir)\%(RecursiveDir)%(Filename)%(Extension)')" />
    <Exec Command="Move /Y $(ApplicationEditorDeploymentDir)\Web_Default.config $(ApplicationEditorDeploymentDir)\Web.config" />

    <Message Text="Creating reference data editor deployment ..." />
    <Copy SourceFiles="@(RefDataEditorDeployment)"
          DestinationFiles="@(RefDataEditorDeployment->'$(RefDataEditorDeploymentDir)\%(RecursiveDir)%(Filename)%(Extension)')" />
    <Exec Command="Move /Y $(RefDataEditorDeploymentDir)\Web_Default.config $(RefDataEditorDeploymentDir)\Web.config" />

    <Message Text="Creating reference data service deployment ..." />
    <Copy SourceFiles="@(RefDataServiceDeployment)"
          DestinationFiles="@(RefDataServiceDeployment->'$(RefDataServiceDeploymentDir)\%(RecursiveDir)%(Filename)%(Extension)')" />
    <Exec Command="Move /Y $(RefDataServiceDeploymentDir)\Web_Default.config $(RefDataServiceDeploymentDir)\Web.config" />
    <Exec Command="Move /Y $(RefDataServiceDeploymentDir)\XML\Repositories_Default.xml $(RefDataServiceDeploymentDir)\XML\Repositories.xml" />
    <Exec Command="Mkdir $(RefDataServiceDeploymentDir)\Logs" />

    <Message Text="Creating Joseki sandbox service deployment ..." />
    <Copy SourceFiles="@(JosekiSandboxServiceDeployment)"
          DestinationFiles="@(JosekiSandboxServiceDeployment->'$(JosekiSandboxServiceDeploymentDir)\%(RecursiveDir)%(Filename)%(Extension)')" />
    <Exec Command="Move /Y $(JosekiSandboxServiceDeploymentDir)\setup.default.conf $(JosekiSandboxServiceDeploymentDir)\setup.conf" />
    <Exec Command="Move /Y $(JosekiSandboxServiceDeploymentDir)\webapps\joseki\WEB-INF\web.default.xml $(JosekiSandboxServiceDeploymentDir)\webapps\joseki\WEB-INF\web.xml" />

    <Message Text="Creating SemWeb sandbox service deployment ..." />
    <Copy SourceFiles="@(SemWebSandboxServiceDeployment)"
          DestinationFiles="@(SemWebSandboxServiceDeployment->'$(SemWebSandboxServiceDeploymentDir)\%(RecursiveDir)%(Filename)%(Extension)')" />
    <Exec Command="Move /Y $(SemWebSandboxServiceDeploymentDir)\Web_Default.config $(SemWebSandboxServiceDeploymentDir)\Web.config" />
    <Exec Command="Move /Y $(SemWebSandboxServiceDeploymentDir)\setup_default.conf $(SemWebSandboxServiceDeploymentDir)\setup.conf" />

    <Message Text="Creating adapter tools deployment ..." />
    <Copy SourceFiles="@(AdapterToolsDeployment)"
          DestinationFiles="@(AdapterToolsDeployment->'$(AdapterToolsDeploymentDir)\%(RecursiveDir)%(Filename)%(Extension)')" />
    <Exec Command="Move /Y $(AdapterToolsDeploymentDir)\App_Default.config $(AdapterToolsDeploymentDir)\DBDictionaryUtil.exe.config" />

    <Message Text="Creating sandbox tools deployment ..." />
    <Copy SourceFiles="@(SandboxToolsDeployment)"
          DestinationFiles="@(SandboxToolsDeployment->'$(SandboxToolsDeploymentDir)\%(RecursiveDir)%(Filename)%(Extension)')" />
    <Exec Command="Move /Y $(SandboxToolsDeploymentDir)\App_Default.config $(SandboxToolsDeploymentDir)\QMXFGenerator.exe.config" />

    <Message Text="Creating landing page deployment ..." />
    <Copy SourceFiles="@(LandingPageDeployment)"
          DestinationFiles="@(LandingPageDeployment->'$(LandingPageDeploymentDir)\%(RecursiveDir)%(Filename)%(Extension)')" />

    <Message Text="Creating CSVDataLayer deployment ..." />
    <Copy SourceFiles="@(CSVDataLayerDeployment)"
          DestinationFiles="@(CSVDataLayerDeployment->'$(CSVDataLayerDeploymentDir)\%(RecursiveDir)%(Filename)%(Extension)')" />

    <Message Text="Creating CSVDataLayer library deployment ..." />
    <Copy SourceFiles="@(CSVDataLayerLibDeployment)"
          DestinationFiles="@(CSVDataLayerLibDeployment->'$(CSVDataLayerLibDeploymentDir)\%(RecursiveDir)%(Filename)%(Extension)')" />

  </Target>

  <Target Name="CreatePackages" DependsOnTargets="CreateDeployment">
    <Exec Command="$(zipCmd) %(DeploymentPackage.Options) %(DeploymentPackage.ZipFile) %(DeploymentPackage.FileSet)" />
  </Target>

  <Target Name="Build" DependsOnTargets="SvnUpdate; CoreBuild"/>

  <Target Name="Rebuild" DependsOnTargets="SvnUpdate; CleanBuild; PrepareBuild; CoreBuild"/>

  <Target Name="All" DependsOnTargets="Rebuild; Test; CreatePackages"/>
</Project>