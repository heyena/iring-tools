<?xml version="1.0" encoding="UTF-8"?>
<localEntry xmlns="http://ws.apache.org/ns/synapse" key="dtiSplit">
  <xsl:stylesheet xmlns:xsl="http://www.w3.org/1999/XSL/Transform" xmlns:fn="http://www.w3.org/2005/02/xpath-functions" xmlns:dti="http://www.iringtools.org/dxfr/dti" version="2.0" exclude-result-prefixes="fn dti">
    <xsl:output method="xml" omit-xml-declaration="yes" indent="yes"/>
    
    <xsl:template match="/">
      <dataTransferIndices>
        <sourceDataTransferIndexList>
          <xsl:for-each select="/dti:dataTransferIndices/dti:dataTransferIndexList/dti:dataTransferIndex[dti:transferType != 'Delete']">
            <xsl:call-template name="createDataTransferIndex"/>
          </xsl:for-each>
        </sourceDataTransferIndexList>
        <targetDataTransferIndexList>
          <xsl:for-each select="/dti:dataTransferIndices/dti:dataTransferIndexList/dti:dataTransferIndex[dti:transferType = 'Change'] |                      /dti:dataTransferIndices/dti:dataTransferIndexList/dti:dataTransferIndex[dti:transferType = 'Delete']">
            <xsl:call-template name="createDataTransferIndex"/>
          </xsl:for-each>
        </targetDataTransferIndexList>
      </dataTransferIndices>
    </xsl:template>

    <xsl:template name="createDataTransferIndex">
      <dataTransferIndex>
        <identifier>
          <xsl:value-of select="dti:identifier"/>
        </identifier>
        <hashValue>
          <xsl:value-of select="dti:hashValue"/>
        </hashValue>
        <transferType>
          <xsl:value-of select="dti:transferType"/>
        </transferType>
      </dataTransferIndex>
    </xsl:template>
  </xsl:stylesheet>
</localEntry>
