/*
 * File: Scripts/AM/view/nhibernate/SetRelationForm.js
 *
 * This file was generated by Sencha Architect version 2.1.0.
 * http://www.sencha.com/products/architect/
 *
 * This file requires use of the Ext JS 4.1.x library, under independent license.
 * License of Sencha Architect does not include license for Ext JS 4.1.x. For more
 * details see http://www.sencha.com/license or contact license@sencha.com.
 *
 * This file will be auto-generated each and everytime you save your project.
 *
 * Do NOT hand edit this file.
 */

Ext.define('AM.view.nhibernate.SetRelationForm', {
  extend: 'Ext.form.Panel',
  alias: 'widget.setrelationform',

  requires: [
    'AM.view.nhibernate.RelationPropertyGrid'
  ],

  rootNode: '',
  endpoint: '',
  contextName: '',
  bodyStyle: 'background:#eee;padding:10 0 0 10',

  initComponent: function() {
    var me = this;

    Ext.applyIf(me, {
      items: [
        {
          xtype: 'label',
          cls: 'x-form-item',
          style: 'font-weight:bold;',
          text: 'Configure Relationship'
        },
        {
          xtype: 'textfield',
          anchor: '100%',
          name: 'relationshipName',
          readOnly: true,
          fieldLabel: 'Relationship Name',
          labelWidth: 160,
          allowBlank: false
        },
        {
          xtype: 'textfield',
          anchor: '100%',
          name: 'objectName',
          readOnly: true,
          fieldLabel: 'Object Name',
          labelWidth: 160,
          allowBlank: false
        },
        {
          xtype: 'combobox',
          anchor: '100%',
          itemId: 'relatedObjectCmb',
          name: 'relatedObjectName',
          fieldLabel: 'Related Object Name',
          labelWidth: 160,
          selectOnFocus: true,
          queryMode: 'local',
          valueField: 'value',
          listeners: {
            select: {
              fn: me.onRelatedObjectSelect,
              scope: me
            }
          }
        },
        {
          xtype: 'combobox',
          anchor: '100%',
          name: 'relationType',
          fieldLabel: 'Relation Type',
          labelWidth: 160,
          allowBlank: false,
          queryMode: 'local',
          store: [
            [
              0,
              'OneToOne'
            ],
            [
              1,
              'OneToMany'
            ]
          ]
        },
        {
          xtype: 'combobox',
          anchor: '100%',
          itemId: 'propertyNameCmb',
          name: 'propertyName',
          fieldLabel: 'Property Name',
          labelWidth: 160,
          queryMode: 'local',
          listeners: {
            select: {
              fn: me.onPropertySelect,
              scope: me
            }
          }
        },
        {
          xtype: 'combobox',
          anchor: '100%',
          itemId: 'mapPropertyNameCmb',
          name: 'mapPropertyName',
          fieldLabel: 'Mapping Property',
          labelWidth: 160,
          queryMode: 'local'
        },
        {
          xtype: 'relationPropertyGrid'
        }
      ]
    });

    me.callParent(arguments);
  },

  onRelatedObjectSelect: function(combo, records, options) {
    var me = this;
    var form = combo.up('setrelationform');
    var rootNode = form.rootNode;
    var relatedObjectName = records[0].data.text;

    if (relatedObjectName !== '') {
      var relatedDataObjectNode = rootNode.findChild('text', relatedObjectName);
      var relationConfigPanel = form.getForm();
      var mappingProperties = [];

      if (relatedDataObjectNode.childNodes[1]) {
        keysNode = relatedDataObjectNode.childNodes[0];
        propertiesNode = relatedDataObjectNode.childNodes[1];
        var ii = 0;

        keysNode.eachChild(function(child) {
          mappingProperties.push([ii, child.data.text, child.data.property.columnName]);
          ii++;
        });

        propertiesNode.eachChild(function(child) {
          mappingProperties.push([ii, child.data.text, child.data.property.columnName]);
          ii++;
        });
      }

      var mapCombo = form.down('#mapPropertyNameCmb');
      mapCombo.store = Ext.create('Ext.data.SimpleStore', {
        fields: ['value', 'text', 'name'],
        autoLoad: true,
        data: mappingProperties
      });
    }
  },

  onPropertySelect: function(combo, records, options) {

  }

});